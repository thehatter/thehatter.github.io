---
layout: post
title:  "Akavita.by встраивает вредоносный код на сайты своих клиентов!"
description: "Известный рейтинг сайтов akavita.by встраивает на страницы своих клиентов вредоносный код из-за которого их сайты блокируют"
date:   2017-03-29 00:00:00
lang: ru
share: public
ref: akavita
categories: ru
img: /assets/img/post_imgs/blocked_site.png
---

Меня часто просят разобраться с блокировкой сайтов, которые попали в “список небезопасных”. Чаще всего сайты попадают в эти списки из-за взлома хакерами и последующего дефейса или скрытого встраивания на сайт вредоносного кода. 

Случай же произошедший на прошлой неделе интересен тем, что сайт клиента не был взломан. Клиент, всего лишь, установил на сайт безобидный счетчик известного рейтинга Акавита (akavita.by), в результате чего на сайт, как и на сайты многих пользователей использующих тот же счетчик, был добавлен потенциально вредоносный код открывающий невидимый iframe, который проходил на сторонний адрес, очевидно, с целью накрутки и заработка на показах некоего контента.



### Как все было:

Я прошел на сайт клиента и увидел весьма знакомую картину:
![Bloked site](/assets/img/post_imgs/blocked_site.png){: .fw }

Сайт блокирован и пройти на него можно лишь открыв дополнительную опцию и согласившись рискнуть. 

Клиент любезно предоставил мне всю информацию для доступа к сайту и я решил проверить код движка сайта (в данном случае это был сайт на популярной cms - joomla). Открыв директорию с сайтом я сразу решил что сайт взломали потому что невооруженным взглядом были видны нестандартные названия файлов и директорий. Но как оказалось после минуты изучения - это был просто бардак в главной директории, а вредоносных файлов как таковых нет. 

В чем же тогда проблема? Я начал рассматривать код страницы с помощью developer tools и в конце страницы обнаружил скрытый iframe содержащий код стороннего сайта наполненного подозрительным контентом - там были товары из aliexpress и т.п.
Что интересно, после перезагрузки страницы этот фрейм обнаружить не удалось и лишь очистка кеша браузера привела к его повторному появлению. 
![My helpful screenshot](/assets/img/post_imgs/akavita_iframe_on_page.png)
{: .bg_img }

Осталось выяснить кто же создал этот iframe.
Еще раз перерыв код шаблонов темы сайта (туда обычно хакеры встраивают свой вредоносный код), и ничего не обнаружив, я взялся за профайлер. И к моему удивлению, выяснилось, что данный фрейм создается ничем иным как скриптом с сайта Акавита загружаемым вместе с вышеупомянутым информером рейтинга.
![My helpful screenshot](/assets/img/post_imgs/akavita_script_on_page.png)

Я отправил владельцам сайта Акавита письмо со скриншотами, ссылками и просьбой пояснить - что же у них не так:
![My helpful screenshot](/assets/img/post_imgs/akavita_latter.png)
{: .bg_img }

> Через день после отправки письма, строка кода из того же файла на Акавита исчезла.

Но ответа я так и не получил, а прошла уже почти неделя! Через день после отправки письма, строчка кода из того же файла на Акавита исчезла. Но мы же не в каменном веке живем и [на сайте archive.org](http://web.archive.org/web/20170325140404/https://adlik.akavita.com/acode.js) есть копия этого скрипта. Так что все доказательства наличия скрипта на месте и последним стала реакция на письмо.

Я подал сайт клиента на проверку гуглом и... о чудо! Проблема исчезла! Сайт снова доступен и никаких красных экранов.
Возможно, это не единственный сайт который был заблокирован, и уж точно в последствии были бы заблокированы еще сайты.

P.S. Мораль этой истории такова - если не хотите что бы ваш сайт заблокировали - не верьте сомнителньым рейтингам и не устанавливайте на сайт их информеры.
<div>
</div>
<br>
